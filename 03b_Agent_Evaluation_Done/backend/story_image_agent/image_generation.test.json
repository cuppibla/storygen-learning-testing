{
  "eval_set_id": "image_agent_generation_tests",
  "name": "Story Image Agent Generation Tests",
  "description": "Unit tests for story_image_agent focusing on tool usage, image generation, and error handling",
  "eval_cases": [
    {
      "eval_id": "basic_image_generation",
      "conversation": [
        {
          "invocation_id": "test-image-001",
          "user_content": {
            "parts": [
              {
                "text": "{\"scene_description\": \"Rolling along wet city streets at night, glowing neon signs reflecting on the rainy pavement, urban atmosphere with fallen leaves scattered around\", \"character_descriptions\": {\"Unit 7\": \"Small round robot (basketball-sized), shiny metallic silver body with chrome finish, perfectly spherical with smooth curves, single bright cyan-blue circular LED eye (3 inches diameter) centered on front, two thin retractable mechanical arms with three-fingered grippers, moves on four small black rubber wheels hidden underneath, has a flip-open compartment on top that reveals a red umbrella, always has a gentle blue glow emanating from seams\"}}"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "text": "{\"success\": true, \"images_generated\": 1, \"images_in_bucket\": 1, \"bucket_name\": \"test-genmedia-bucket\", \"token_safe\": true, \"images\": [{\"index\": 0, \"gcs_url\": \"https://storage.googleapis.com/test-genmedia-bucket/generated_images/20241201_120000_robot_city_0_abcd1234.png\", \"format\": \"png\", \"stored_in_bucket\": true}]}"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "args": {
                  "prompt": "Children's book cartoon illustration with bright vibrant colors, simple shapes, friendly characters. Scene: Rolling along wet city streets at night, glowing neon signs reflecting on the rainy pavement, urban atmosphere with fallen leaves scattered around. Character descriptions: Unit 7 is Small round robot (basketball-sized), shiny metallic silver body with chrome finish, perfectly spherical with smooth curves, single bright cyan-blue circular LED eye (3 inches diameter) centered on front, two thin retractable mechanical arms with three-fingered grippers, moves on four small black rubber wheels hidden underneath, has a flip-open compartment on top that reveals a red umbrella, always has a gentle blue glow emanating from seams",
                  "aspect_ratio": "16:9",
                  "number_of_images": 1
                },
                "name": "generate_image"
              }
            ],
            "intermediate_responses": []
          }
        }
      ],
      "session_input": {
        "app_name": "story_image_agent",
        "user_id": "user",
        "state": {}
      }
    },
    {
      "eval_id": "multiple_characters_test",
      "conversation": [
        {
          "invocation_id": "test-image-002",
          "user_content": {
            "parts": [
              {
                "text": "{\"scene_description\": \"Inside a warm bakery, kind baker in apron offering a saucer of milk, cozy interior with bread on shelves\", \"character_descriptions\": {\"Unit 7\": \"Small round robot (basketball-sized), shiny metallic silver body with chrome finish, perfectly spherical with smooth curves, single bright cyan-blue circular LED eye (3 inches diameter) centered on front\", \"Lost Kitten\": \"Tiny 8-week-old kitten, bright orange tabby with distinct dark orange tiger stripes, pure white paws like little socks, large emerald green eyes with vertical pupils, pink button nose, fluffy medium-length fur\"}}"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "text": "{\"success\": true, \"images_generated\": 1, \"images_in_bucket\": 1, \"bucket_name\": \"test-genmedia-bucket\", \"token_safe\": true, \"images\": [{\"index\": 0, \"gcs_url\": \"https://storage.googleapis.com/test-genmedia-bucket/generated_images/20241201_120100_bakery_scene_0_efgh5678.png\", \"format\": \"png\", \"stored_in_bucket\": true}]}"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "args": {
                  "prompt": "Children's book cartoon illustration with bright vibrant colors, simple shapes, friendly characters. Scene: Inside a warm bakery, kind baker in apron offering a saucer of milk, cozy interior with bread on shelves. Character descriptions: Unit 7 is Small round robot (basketball-sized), shiny metallic silver body with chrome finish, perfectly spherical with smooth curves, single bright cyan-blue circular LED eye (3 inches diameter) centered on front; Lost Kitten is Tiny 8-week-old kitten, bright orange tabby with distinct dark orange tiger stripes, pure white paws like little socks, large emerald green eyes with vertical pupils, pink button nose, fluffy medium-length fur",
                  "aspect_ratio": "16:9",
                  "number_of_images": 1
                },
                "name": "generate_image"
              }
            ],
            "intermediate_responses": []
          }
        }
      ],
      "session_input": {
        "app_name": "story_image_agent",
        "user_id": "user",
        "state": {}
      }
    },
    {
      "eval_id": "plain_text_input_test",
      "conversation": [
        {
          "invocation_id": "test-image-003",
          "user_content": {
            "parts": [
              {
                "text": "A friendly dragon with emerald scales discovering a treasure map in a magical forest"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "text": "{\"success\": true, \"images_generated\": 1, \"images_in_bucket\": 1, \"bucket_name\": \"test-genmedia-bucket\", \"token_safe\": true, \"images\": [{\"index\": 0, \"gcs_url\": \"https://storage.googleapis.com/test-genmedia-bucket/generated_images/20241201_120200_dragon_forest_0_ijkl9012.png\", \"format\": \"png\", \"stored_in_bucket\": true}]}"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "args": {
                  "prompt": "Children's book cartoon illustration with bright vibrant colors, simple shapes, friendly characters. Scene: A friendly dragon with emerald scales discovering a treasure map in a magical forest.",
                  "aspect_ratio": "16:9",
                  "number_of_images": 1
                },
                "name": "generate_image"
              }
            ],
            "intermediate_responses": []
          }
        }
      ],
      "session_input": {
        "app_name": "story_image_agent",
        "user_id": "user",
        "state": {}
      }
    },
    {
      "eval_id": "error_handling_test",
      "conversation": [
        {
          "invocation_id": "test-image-004",
          "user_content": {
            "parts": [
              {
                "text": ""
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "text": "{\"success\": false, \"error\": \"No scene description provided\"}"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [],
            "intermediate_responses": []
          }
        }
      ],
      "session_input": {
        "app_name": "story_image_agent",
        "user_id": "user",
        "state": {}
      }
    },
    {
      "eval_id": "bucket_fallback_test",
      "conversation": [
        {
          "invocation_id": "test-image-005",
          "user_content": {
            "parts": [
              {
                "text": "A simple garden scene with a butterfly on a flower"
              }
            ],
            "role": "user"
          },
          "final_response": {
            "parts": [
              {
                "text": "{\"success\": true, \"images_generated\": 1, \"images_in_bucket\": 0, \"bucket_name\": null, \"token_safe\": false, \"images\": [{\"index\": 0, \"base64\": \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==\", \"format\": \"png\", \"stored_in_bucket\": false}]}"
              }
            ],
            "role": "model"
          },
          "intermediate_data": {
            "tool_uses": [
              {
                "args": {
                  "prompt": "Children's book cartoon illustration with bright vibrant colors, simple shapes, friendly characters. Scene: A simple garden scene with a butterfly on a flower.",
                  "aspect_ratio": "16:9",
                  "number_of_images": 1
                },
                "name": "generate_image"
              }
            ],
            "intermediate_responses": []
          }
        }
      ],
      "session_input": {
        "app_name": "story_image_agent",
        "user_id": "user",
        "state": {}
      }
    }
  ]
}
